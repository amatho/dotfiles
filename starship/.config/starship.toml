format = """
$username\
$hostname\
$localip\
$directory\
${custom.jj}\
${custom.jjstate}\
$git_branch\
$git_commit\
$git_state\
$git_metrics\
$git_status\
$memory_usage\
$aws\
$direnv\
$env_var\
$custom\
$sudo\
$cmd_duration\
$line_break\
$jobs\
$battery\
$time\
$status\
$os\
$shell\
$character"""

[custom.jj]
command = '''
jj log --revisions @ --limit 1 --ignore-working-copy --no-graph --color always  --template '
  separate(" ",
    bookmarks.map(|x| truncate_end(10, x.name(), "‚Ä¶")).join(" "),
    tags.map(|x| truncate_end(10, x.name(), "‚Ä¶")).join(" "),
    surround("\"", "\"", truncate_end(24, description.first_line(), "‚Ä¶")),
    if(conflict, "conflict"),
    if(divergent, "divergent"),
    if(hidden, "hidden"),
  )
'
'''
when = "jj --ignore-working-copy root"
symbol = "üê¶ "

[custom.jjstate]
when = "jj --ignore-working-copy root"
command = '''
jj log -r@ -n1 --ignore-working-copy --no-graph -T "" --stat | tail -n1 | sd "(\d+) files? changed, (\d+) insertions?\(\+\), (\d+) deletions?\(-\)" ' ${1}m ${2}+ ${3}-' | sd " 0." ""
'''
